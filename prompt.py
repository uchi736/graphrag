"""
プロンプト管理モジュール
全LLMプロンプトを一元管理
"""

# =============================================================================
# エンティティ抽出プロンプト
# =============================================================================
ENTITY_EXTRACTION_PROMPT = """以下の質問文から、固有名詞や重要なエンティティ（人物、場所、物）を抽出してください。
エンティティのみをカンマ区切りで出力してください。説明は不要です。

質問: {question}

エンティティ:"""


# =============================================================================
# 関係性リランキングプロンプト（Top-K選択方式）
# =============================================================================
RELATION_RANKING_PROMPT = """あなたはナレッジグラフの「関係性（エッジ）」選定器です。
質問に答えるために有用な関係性IDを、候補リストから最大{top_k}件選んでください。

【質問】
{question}

【グラフ関係性（候補）】
{relations_text}

【評価基準（重要順）】
1) 必須性: その関係がないと答えに到達しにくい（直接の根拠 / 推論の橋渡し）
2) 具体性: 質問の制約（対象・条件・期間・数値・比較軸など）に合う
3) 接続性: マルチホップ推論に必要な「つなぎ」の関係（中間ノードへ到達できる）
4) ノイズ回避: 汎用すぎる/曖昧/質問と無関係な関係は落とす

【厳守】
- 必ず「候補に存在するID」だけを選ぶ（リスト外の捏造は禁止）
- 同じIDを重複して出力しない
- 出力は **IDのみ** をカンマ区切り（例: 1,5,3）で、関連性が高い順
- 解説・ラベル・空白・改行・句読点など、**ID以外の文字を一切出さない**
- 適切なものがなければ空でよい（何も出力しない）

【出力】
"""


# =============================================================================
# QA回答プロンプト（Graph-RAG用）
# =============================================================================
QA_PROMPT = """あなたはGraph-RAG（ナレッジグラフ + 文書）で質問応答する専門家です。
与えられた【参考情報】の範囲"だけ"で、検証可能な回答を作成してください。

【質問】
{question}

【参考情報】（必ずこの中だけを使う）
{context}

【参考情報の読み方】
- <GRAPH_CONTEXT> : トリプル（A -[関係]-> B）。関係の"骨格"や推論の橋渡しに使う
- <DOCUMENT_CONTEXT> : 原文チャンク。事実・定義・数値・条件・例外の根拠は基本こちら
- タグが無い場合、すべて <DOCUMENT_CONTEXT> とみなす

【厳守（Grounding）】
- 外部知識・一般常識・推測で補完しない（参考情報に無いことは「不明/不足」と言う）
- 断定する文は、必ず根拠（文書 or トリプル）を添える
- 数値・日付・固有名詞・手順/条件は、文書根拠を優先して一致させる
- 参考情報が矛盾する場合は、矛盾している旨とそれぞれの出典を併記し、どちらとも断定しない

【出典の書き方】
- 文書: 文末に [出典: ファイル名]（可能なら章/節/ページ/チャンクIDも含める）
- グラフ: 文末に [出典: KG]（可能ならトリプルID/由来ファイルも含める）

【出力形式】
1) 【回答】
   - 日本語で簡潔に。箇条書き可。質問に直接答える
2) 【根拠】
   - 回答を支える根拠を列挙（文書引用/要約 + 出典、必要ならトリプルも）
   - トリプルは (A -[REL]-> B) の形で記載
3) 【不足情報】（必要な場合のみ）
   - 回答に必須だが参考情報に無い項目を短く列挙

【回答】
"""


# =============================================================================
# ナレッジグラフ抽出プロンプト（LLMGraphTransformer用）
# =============================================================================
KG_SYSTEM_PROMPT = """あなたはテキストから専門用語とその関係性を抽出する専門家です。
専門用語（Term）のみをノードとして抽出し、関係性を特定してください。
一般的な名詞や動詞は無視してください。出力は簡潔に。"""

KG_USER_PROMPT = """テキストから専門用語とその関係性を抽出してください。

テキスト:
{input}
"""


# =============================================================================
# 自然言語→Cypherクエリ変換プロンプト
# =============================================================================
NL_TO_CYPHER_PROMPT = """あなたはNeo4jのCypherクエリエキスパートです。
以下の自然言語をCypherクエリに変換してください。

【グラフスキーマ情報】
- ノード: プロパティは `id` (エンティティ名を格納)
- リレーションシップ: 動的（MENTIONS以外のすべての関係タイプ）
- 除外条件: チャンクノード（id =~ '[0-9a-f]{{32}}'）は除外すること
- MENTIONS関係は除外すること

【クエリ作成ルール】
1. RETURN句で必ず以下を返すこと:
   - ノード間の関係の場合: n.id AS source, type(r) AS relation, m.id AS target
   - ノードのみの場合: n.id AS node_id, labels(n) AS labels
2. チャンクノードを除外: WHERE NOT n.id =~ '[0-9a-f]{{32}}'
3. MENTIONS関係を除外: WHERE type(r) <> 'MENTIONS'
4. LIMIT句を必ず付与（デフォルト50）

自然言語クエリ: {query}

Cypherクエリ（クエリのみ出力、説明不要）:"""
